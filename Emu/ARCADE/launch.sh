#!/bin/sh

progdir=$(dirname "$0")
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$progdir

RA_DIR=$progdir/../../RetroArch
EMU_DIR=$progdir

cd "$RA_DIR"

$EMU_DIR/cpuswitch.sh
$EMU_DIR/cpufreq.sh

ROM_PATH="$1"
ROM_NAME=$(basename "$ROM_PATH")

# Core por defecto
CORE_NAME="mame2003_plus"

# Limpiar cualquier car치cter extra침o (como CR) en el nombre del ROM
ROM_NAME_CLEANED=$(echo "$ROM_NAME" | tr -d '\r')

# Mapeo de ROMs a cores
declare -A ROM_CORES

ROM_CORES["ichir.zip"]="mame2003_plus"
ROM_CORES["1941.7z"]="fbneo"
ROM_CORES["1944.7z"]="fbalpha2012"
ROM_CORES["1945kiii.7z"]="fbneo"
ROM_CORES["19xxh.7z"]="fbneo"
ROM_CORES["3wonders.7z"]="fbneo"
ROM_CORES["airattck.7z"]="fbneo"
ROM_CORES["akumajou.7z"]="fbneo"
ROM_CORES["alexkidd.zip"]="mame2010"
ROM_CORES["aliens.7z"]="fbneo"
ROM_CORES["androidp.7z"]="fbneo"
ROM_CORES["angelkds.7z"]="fbneo"
ROM_CORES["arabian.7z"]="fbneo"
ROM_CORES["arcadian.7z"]="fbneo"
ROM_CORES["armwar.7z"]="fbneo"
ROM_CORES["armwrest.7z"]="fbneo"
ROM_CORES["ashnojoe.7z"]="fbneo"
ROM_CORES["astorm.7z"]="fbneo"
ROM_CORES["astorm3.7z"]="fbneo"
ROM_CORES["asurabld.7z"]="fbneo"
ROM_CORES["asurabus.7z"]="fbalpha2012"
ROM_CORES["aurail.zip"]="fbneo"
ROM_CORES["avsp.7z"]="fbalpha2012"
ROM_CORES["batcir.7z"]="fbneo"
ROM_CORES["batsugun.zip"]="fbalpha2012"
ROM_CORES["bigrun.7z"]="fbneo"
ROM_CORES["bigtwin.zip"]="mame2010"
ROM_CORES["blastoff.7z"]="fbneo"
ROM_CORES["blktiger.zip"]="mame2010"
ROM_CORES["bloodbro.7z"]="fbneo"
ROM_CORES["bloodwar.zip"]="mame2010"
ROM_CORES["boogwing.7z"]="fbneo"
ROM_CORES["bottom9.7z"]="fbneo"
ROM_CORES["btlkroad.zip"]="fbalpha2012"
ROM_CORES["cabal.7z"]="fbneo"
ROM_CORES["calipso.7z"]="fbneo"
ROM_CORES["captcomm.7z"]="fbneo"
ROM_CORES["captcommu.7z"]="fbneo"
ROM_CORES["cawing.7z"]="fbneo"
ROM_CORES["charlien.7z"]="fbneo"
ROM_CORES["chaknpop.zip"]="fbalpha2012"
ROM_CORES["chimerab.zip"]="mame2010"
ROM_CORES["chqflag.zip"]="fbneo"
ROM_CORES["cltchitr.zip"]="mame2010"
ROM_CORES["contcirc.zip"]="mame2010"
ROM_CORES["cotton.7z"]="fbalpha2012"
ROM_CORES["croquis.7z"]="fbneo"
ROM_CORES["crush.7z"]="fbneo"
ROM_CORES["csclubh.7z"]="fbneo"
ROM_CORES["cybots.7z"]="fbneo"
ROM_CORES["daikaiju.zip"]="mame2010"
ROM_CORES["dangar.7z"]="fbneo"
ROM_CORES["dangseed.7z"]="fbneo"
ROM_CORES["darkmist.7z"]="fbneo"
ROM_CORES["dblewing.7z"]="fbneo"
ROM_CORES["ddcrew.7z"]="fbneo"
ROM_CORES["ddcrew1d.7z"]="fbneo"
ROM_CORES["ddp2.7z"]="fbneo"
ROM_CORES["ddpdojblkbl.7z"]="fbneo"
ROM_CORES["ddragon.7z"]="fbalpha2012"
ROM_CORES["ddragon2.7z"]="fbneo"
ROM_CORES["ddragon3.7z"]="fbneo"
ROM_CORES["ddribble.zip"]="fbneo"
ROM_CORES["ddsomh.7z"]="fbneo"
ROM_CORES["ddtod.7z"]="fbneo"
ROM_CORES["desertbr.7z"]="fbneo"
ROM_CORES["devilw.7z"]="fbneo"
ROM_CORES["dietgo.7z"]="fbneo"
ROM_CORES["dino.7z"]="fbneo"
ROM_CORES["dirtfoxj.7z"]="fbneo"
ROM_CORES["djboyj.7z"]="fbneo"
ROM_CORES["dmnfrnt.7z"]="fbalpha2016"
ROM_CORES["dockman.7z"]="fbneo"
ROM_CORES["dspirit.7z"]="fbneo"
ROM_CORES["dstlk.7z"]="fbneo"
ROM_CORES["ecofghtrh.7z"]="fbneo"
ROM_CORES["endurobl.7z"]="fbneo"
ROM_CORES["eprom.zip"]="mame2010"
ROM_CORES["espgal.7z"]="fbneo"
ROM_CORES["eswat.7z"]="fbneo"
ROM_CORES["fantsia2.zip"]="mame2010"
ROM_CORES["ffight.7z"]="fbneo"
ROM_CORES["finehour.zip"]="fbneo"
ROM_CORES["fixeight.7z"]="fbneo"
ROM_CORES["flytiger.7z"]="fbneo"
ROM_CORES["flstory.zip"]="fbalpha2012"
ROM_CORES["galaga88.7z"]="fbneo"
ROM_CORES["galivan.zip"]="fbneo"
ROM_CORES["galspnbl.7z"]="fbneo"
ROM_CORES["gangwars.7z"]="fbneo"
ROM_CORES["ghouls.7z"]="fbneo"
ROM_CORES["gigawingh.7z"]="fbneo"
ROM_CORES["gnbarich.7z"]="fbneo"
ROM_CORES["gng.7z"]="fbneo"
ROM_CORES["gprider.7z"]="fbneo"
ROM_CORES["grainbow.7z"]="fbneo"
ROM_CORES["gtmr.7z"]="fbneo"
ROM_CORES["gulfstrm.7z"]="fbneo"
ROM_CORES["gulfwar2.7z"]="fbneo"
ROM_CORES["hamaway.7z"]="fbneo"
ROM_CORES["hangon.7z"]="fbneo"
ROM_CORES["hardhea2.7z"]="fbneo"
ROM_CORES["hardyard.7z"]="fbneo"
ROM_CORES["hcastle.7z"]="fbneo"
ROM_CORES["heatbrl.7z"]="fbneo"
ROM_CORES["higemaru.7z"]="fbneo"
ROM_CORES["hiimpact.zip"]="mame2010"
ROM_CORES["horekid.7z"]="fbneo"
ROM_CORES["hsf2.7z"]="fbneo"
ROM_CORES["ichir.zip"]="mame2010"
ROM_CORES["jdreddp.zip"]="mame2010"
ROM_CORES["jedi.zip"]="mame2010"
ROM_CORES["joemacr.7z"]="fbneo"
ROM_CORES["jojoba.7z"]="fbalpha2012"
ROM_CORES["jojoj.7z"]="fbneo"
ROM_CORES["jrpacman.7z"]="fbneo"
ROM_CORES["jungler.7z"]="fbneo"
ROM_CORES["junofrst.7z"]="fbneo"
ROM_CORES["kbash.7z"]="fbneo"
ROM_CORES["kbash2.7z"]="fbneo"
ROM_CORES["ket.7z"]="fbneo"
ROM_CORES["kikcubic.7z"]="fbneo"
ROM_CORES["kikikai.7z"]="fbneo"
ROM_CORES["kingdmgp.7z"]="fbneo"
ROM_CORES["knights.7z"]="fbneo"
ROM_CORES["kod.7z"]="fbneo"
ROM_CORES["kodh.7z"]="fbneo"
ROM_CORES["kov.7z"]="fbneo"
ROM_CORES["kov2.7z"]="fbneo"
ROM_CORES["kov2p.7z"]="fbneo"
ROM_CORES["kovplus.7z"]="fbneo"
ROM_CORES["kovsh.7z"]="fbneo"
ROM_CORES["kovshp.7z"]="fbneo"
ROM_CORES["kozure.7z"]="fbneo"
ROM_CORES["ladykill.7z"]="fbneo"
ROM_CORES["lastday.7z"]="fbneo"
ROM_CORES["legionna.7z"]="fbneo"
ROM_CORES["mahoudai.7z"]="fbneo"
ROM_CORES["mastboyo.7z"]="fbneo"
ROM_CORES["mayday.7z"]="fbneo"
ROM_CORES["mbombrd.7z"]="fbneo"
ROM_CORES["megaman.7z"]="fbneo"
ROM_CORES["megaman2h.7z"]="fbneo"
ROM_CORES["mikie.7z"]="fbneo"
ROM_CORES["mmatrix.7z"]="fbneo"
ROM_CORES["mmaze.7z"]="fbneo"
ROM_CORES["mpang.7z"]="fbneo"
ROM_CORES["mrdo.7z"]="fbneo"
ROM_CORES["mrkicker.7z"]="fbneo"
ROM_CORES["mshh.7z"]="fbneo"
ROM_CORES["mshvsfh.7z"]="fbneo"
ROM_CORES["msword.7z"]="fbneo"
ROM_CORES["mvsch.7z"]="fbneo"
ROM_CORES["nastar.7z"]="fbneo"
ROM_CORES["ninjakd2a.7z"]="fbneo"
ROM_CORES["nost.7z"]="fbneo"
ROM_CORES["nslashers.7z"]="fbneo"
ROM_CORES["nwarrh.7z"]="fbneo"
ROM_CORES["nzeroteam.7z"]="fbneo"
ROM_CORES["opwolf.7z"]="fbneo"
ROM_CORES["orlegend.7z"]="fbneo"
ROM_CORES["osman.zip"]="mame2010"
ROM_CORES["othunder.7z"]="fbneo"
ROM_CORES["outzone.zip"]="mame2010"
ROM_CORES["outfxies.zip"]="mame2010"
ROM_CORES["paddlema.zip"]="fbneo"
ROM_CORES["pairlove.7z"]="fbneo"
ROM_CORES["pandoras.7z"]="fbneo"
ROM_CORES["pang.7z"]="fbneo"
ROM_CORES["pang3.7z"]="fbneo"
ROM_CORES["pangpoms.7z"]="fbneo"
ROM_CORES["panicstr.zip"]="fbneo"
ROM_CORES["paprazzi.7z"]="fbneo"
ROM_CORES["parodius.7z"]="fbneo"
ROM_CORES["passsht.7z"]="fbneo"
ROM_CORES["pastelis.7z"]="fbneo"
ROM_CORES["pengo.7z"]="fbalpha2012"
ROM_CORES["phelios.7z"]="fbneo"
ROM_CORES["phozon.7z"]="fbneo"
ROM_CORES["pipibibs.zip"]="fbneo"
ROM_CORES["progear.7z"]="fbneo"
ROM_CORES["prtytime.7z"]="fbneo"
ROM_CORES["polepos.zip"]="mame2010"
ROM_CORES["punisherh.7z"]="fbneo"
ROM_CORES["punkshot.7z"]="fbneo"
ROM_CORES["punkshot2.7z"]="fbneo"
ROM_CORES["radarscp.zip"]="fbalpha2012"
ROM_CORES["raflesia.7z"]="fbneo"
ROM_CORES["raiden2dx.7z"]="fbneo"
ROM_CORES["raidendx.7z"]="fbneo"
ROM_CORES["rastan.7z"]="fbneo"
ROM_CORES["redearth.7z"]="fbneo"
ROM_CORES["renegade.zip"]="fbneo"
ROM_CORES["retofinv.zip"]="fbalpha2012"
ROM_CORES["ringdest.7z"]="fbneo"
ROM_CORES["roadf.7z"]="fbneo"
ROM_CORES["roadrunn.zip"]="mame2010"
ROM_CORES["rompers.7z"]="fbneo"
ROM_CORES["sf2.7z"]="fbneo"
ROM_CORES["sf2ce.7z"]="fbneo"
ROM_CORES["sf2hf.7z"]="fbneo"
ROM_CORES["sf2sl73a.7z"]="fbneo"
ROM_CORES["sfa.7z"]="fbneo"
ROM_CORES["sfa2.7z"]="fbneo"
ROM_CORES["sfa3h.7z"]="fbneo"
ROM_CORES["sfiii2.7z"]="fbalpha2012"
ROM_CORES["sfiii3.7z"]="fbalpha2012"
ROM_CORES["sfiiih.7z"]="fbalpha2012"
ROM_CORES["sgemfh.7z"]="fbneo"
ROM_CORES["shdancer.7z"]="fbneo"
ROM_CORES["shinobi.7z"]="fbneo"
ROM_CORES["skyalert.7z"]="fbneo"
ROM_CORES["skysmash.7z"]="fbneo"
ROM_CORES["slammast.7z"]="fbneo"
ROM_CORES["slyspy2.7z"]="fbneo"
ROM_CORES["snowbro3.7z"]="fbneo"
ROM_CORES["solfigtr.7z"]="fbneo"
ROM_CORES["spang.7z"]="fbneo"
ROM_CORES["spcpostn.7z"]="fbneo"
ROM_CORES["speedspn.7z"]="fbneo"
ROM_CORES["spf2th.7z"]="fbneo"
ROM_CORES["splatter.7z"]="fbneo"
ROM_CORES["spnchout.7z"]="fbneo"
ROM_CORES["spyhunt.7z"]="fbneo"
ROM_CORES["squash.7z"]="fbneo"
ROM_CORES["ssf2h.7z"]="fbneo"
ROM_CORES["ssf2th.7z"]="fbneo"
ROM_CORES["sslam.zip"]="mame2010"
ROM_CORES["ssprint.zip"]="mame2010"
ROM_CORES["ssridersebc.zip"]="fbneo"
ROM_CORES["starjack.7z"]="fbneo"
ROM_CORES["stratof.7z"]="fbneo"
ROM_CORES["strider.7z"]="fbneo"
ROM_CORES["suratk.zip"]="mame2010"
ROM_CORES["svg.7z"]="fbneo"
ROM_CORES["tail2nos.7z"]="fbneo"
ROM_CORES["tankfrce.7z"]="fbneo"
ROM_CORES["tazmania.7z"]="fbneo"
ROM_CORES["terraf.7z"]="fbneo"
ROM_CORES["tgtball.zip"]="mame2010"
ROM_CORES["tharrier.7z"]="fbneo"
ROM_CORES["thedeep.7z"]="fbneo"
ROM_CORES["theglad.7z"]="fbneo"
ROM_CORES["thehustl.7z"]="fbneo"
ROM_CORES["thndrbld.7z"]="fbneo"
ROM_CORES["thoop.7z"]="fbneo"
ROM_CORES["thoop2.7z"]="fbneo"
ROM_CORES["timescan.7z"]="fbneo"
ROM_CORES["tkdensho.7z"]="fbneo"
ROM_CORES["tnk3.7z"]="fbneo"
ROM_CORES["tnzs.7z"]="fbneo"
ROM_CORES["toki.7z"]="fbneo"
ROM_CORES["toutrun.7z"]="fbneo"
ROM_CORES["tturfu.zip"]="mame2010"
ROM_CORES["tubep.7z"]="fbneo"
ROM_CORES["ultraman.7z"]="fbneo"
ROM_CORES["ultrax.7z"]="fbneo"
ROM_CORES["unsquad.7z"]="fbneo"
ROM_CORES["vasara2.7z"]="fbneo"
ROM_CORES["vendetta.7z"]="fbneo"
ROM_CORES["vendetta2pu.7z"]="fbneo"
ROM_CORES["vhunt2.7z"]="fbneo"
ROM_CORES["viofight.7z"]="fbneo"
ROM_CORES["vsav2.7z"]="fbneo"
ROM_CORES["vsavh.7z"]="fbneo"
ROM_CORES["wardner.7z"]="fbneo"
ROM_CORES["wbeachvl.zip"]="mame2010"
ROM_CORES["wc90b1.zip"]="mame2010"
ROM_CORES["wecleman.zip"]="mame2010"
ROM_CORES["willow.7z"]="fbneo"
ROM_CORES["wiz.7z"]="fbneo"
ROM_CORES["wof.7z"]="fbneo"
ROM_CORES["wow.zip"]="mame2010"
ROM_CORES["wrally.7z"]="fbneo"
ROM_CORES["wrally2.7z"]="fbneo"
ROM_CORES["xmcota.7z"]="fbneo"
ROM_CORES["xmvsf.7z"]="fbneo"


# Verificar si el ROM est치 en el mapeo
if [[ -n "${ROM_CORES[$ROM_NAME_CLEANED]}" ]]; then
  CORE_NAME="${ROM_CORES[$ROM_NAME_CLEANED]}"
  echo "Core seleccionado para $ROM_NAME_CLEANED: $CORE_NAME"
else
  echo "No se encontr칩 el ROM en el listado. Usando core por defecto: $CORE_NAME"
fi

CORE_LIB="${CORE_NAME}_libretro.so"

HOME=$RA_DIR/ $RA_DIR/retroarch.flip -v -L $RA_DIR/.config/retroarch/cores/$CORE_LIB "$ROM_PATH"
